<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Champi</title>
    <link rel="icon" type="image/png" href="./images/champignon.ico" />
    <link rel="stylesheet" type="text/css" href="./styles/globaleStyles.css" />
    <link rel="stylesheet" type="text/css" href="./styles/style.css" />
  </head>
  <body>
    <!-- NAVIGATION -->
    <div class="box">
      <div class="box1">
        <button class="boutonAccueil"><a href="/">Accueil</a></button>
        <button class="boutonAccueil">
          <a href="/pageRelay.html">Gestion Relay</a>
        </button>
        <button class="boutonAccueil">
          <a href="/pageCourbes.html">Courbe</a>
        </button>
      </div>
      <!-- FIN NAVIGATION -->

      <!-- MAIN -->
      <div class="courbePage">
        <canvas id="graph1"></canvas>
      </div>
      <!-- FIN MAIN -->
    </div>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"
      integrity="sha512-QSkVNOCYLtj73J4hbmVoOV6KVZuMluZlioC+trLpewV8qMjsWqlIQvkn1KGX2StWvPMdWGBqim1xlC8krl1EKQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.25.0/axios.js"
      integrity="sha512-II/TvxJGs27N3NEu/WWRFtyhBdSByZwS5ovX1vHXVsi2JXj0I5hRvHwgBPKbzZDk0wsKVDoEUEI8rAYGEF394A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <script>
      let tauxHumidite = [];
      let listTauxHumidite;
      let nbJour = [];

      let getDataCourbeHumidite = () => {
        axios({
          url: 'http://localhost:3003/api/gestionCourbeRoutes/getDataCourbe/',
          method: 'get',
        })
          .then((response) => {
            // console.log(response.data.dataHumidite);

            listTauxHumidite = response.data.dataHumidite;
            listTauxHumidite.forEach((item, index) => {
              tauxHumidite.push({ x: index, y: item['tauxHumidite'] });
              // console.log('tauxHumidite', tauxHumidite);

              nbJour.push({ Période: index });
              console.log('nbJour', nbJour);
            });
          })
          .then(() => {
            let dataConsigneHumidité = [10, 12, 14, 12, 13];

            let data = {
              // Labels = informations de l'axe X.

              labels: nbJour,
              datasets: [
                {
                  label: 'Taux humidite',
                  data: tauxHumidite,
                  xAxisID: 'xAxis1',
                  backgroundColor: 'rgba(255, 99, 132, 0.2)',
                  borderColor: 'rgba(255, 99, 132, 1)',
                  lineTension: 0.2,
                  borderWidth: 2,
                  pointRadius: 1,
                },
                // {
                //   label: 'Consigne Humidite',
                //   data: dataConsigneHumidité,
                //   backgroundColor: 'rgba(54, 162, 235, 0.2)',
                //   borderColor: 'rgba(54, 162, 235, 1)',
                //   lineTension: 0.2,
                //   borderWidth: 2,
                //   pointRadius: 1,
                // },
              ],
            };

            let options = {
              // scales: {
              //   yAxes: [
              //     {
              //       display: true,
              //       position: 'right',
              //       ticks: {
              //         beginAtZero: false,
              //         min: 60,
              //         max: 100,
              //         stepSize: 1,
              //       },
              //     },
              //     {
              //       display: true,
              //       position: 'left',
              //       ticks: {
              //         beginAtZero: false,
              //         min: 60,
              //         max: 100,
              //         stepSize: 1,
              //       },
              //     },
              //   ],

              //   xAxes: [
              //     {
              //       id: 'xAxis1',
              //       type: 'time',
              //       display: false,
              //       time: {
              //         displayFormats: {
              //           quarter: 'HH:mm',
              //         },
              //       },
              //       // ticks:{
              //       //     callback:function(label){
              //       //         return label.heure.hour() + ":" + label.heure.format("mm");
              //       //     }
              //       // }
              //     },
              //     {
              //       id: 'xAxis2',
              //       type: 'category',
              //       display: true,
              //       time: {
              //         displayFormats: {
              //           quarter: 'HH:mm',
              //         },
              //       },
              //       ticks: {
              //         callback: function (label) {
              //           return label.heure.hour() + ':' + label.heure.format('mm');
              //         },
              //       },
              //     },
              //     {
              //       id: 'xAxis3',
              //       type: 'category',
              //       gridLines: {
              //         drawOnChartArea: false, // only want the grid lines for one axis to show up
              //       },
              //       ticks: {
              //         callback: function (label) {
              //           return 'Jour ' + label.jour;
              //         },
              //       },
              //     },
              //   ],
              // },

              plugins: {
                legend: {
                  labels: {
                    font: {
                      size: 16,
                    },
                  },
                },
              },

              layout: {
                padding: 10,
              },

              elements: {
                point: {
                  radius: 0,
                },
              },
            };

            let ctx = document.getElementById('graph1').getContext('2d');

            const config = {
              type: 'line',
              data: data,
              options: options,
            };

            let graph1 = new Chart(ctx, config);
          })
          .catch((error) => {
            console.log(error);
            console.log(JSON.stringify(error));
          });
      };

      getDataCourbeHumidite();
    </script>
  </body>
</html>
